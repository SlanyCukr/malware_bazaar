from selenium import webdriver
from selenium.webdriver import ActionChains, Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service as ChromeService
from selenium.webdriver.firefox.service import Service as FirefoxService
import time

# Setup Selenium WebDriver
options = webdriver.FirefoxOptions()
#service = ChromeService(executable_path='/home/slanycukr/Downloads/chromedriver_linux64/chromedriver')
service = FirefoxService(executable_path='/home/slanycukr/Downloads/geckodriver-v0.34.0-linux64/geckodriver')
driver = webdriver.Firefox(service=service, options=options)
driver.set_page_load_timeout(60)

try:
    # Open the main page
    main_page_url = "http://158.196.22.185:8000/analysis/pending/"
    driver.get(main_page_url)
    driver.implicitly_wait(60)

    while True:
        # Find all links that match the pattern
        links = driver.find_elements(By.XPATH, "//a[contains(@href, '/apiv2/tasks/delete/') and contains(@href, '/pending')]")

        if not links:
            print("No more links found.")
            break

        for link in links:
            # Open the link in a new tab
            ActionChains(driver) \
                .key_down(Keys.CONTROL) \
                .click(link) \
                .key_up(Keys.CONTROL) \
                .perform()

            # Switch to new tab
            driver.switch_to.window(driver.window_handles[1])

            # Wait for the page to load (if necessary)
            # Perform any actions on the new tab here

            # Close the current tab
            driver.close()

            # Switch back to the original tab
            driver.switch_to.window(driver.window_handles[0])

            # Wait before processing the next link
            time.sleep(2)

finally:
    # Close the browser
    driver.quit()
